Add support for variants in the typechecker, see #1847
